{% extends "template.html" %}
{% block content %}

		{% if error %}
			<p class="error"><strong>Error:</strong> {{ error }}</p>
		{% endif %}
<style>
	div.profile {

    padding-left: 100px;
}
</style>



<script src="../static/js/heatmap_d3.js"></script>
<script src="https://d3js.org/d3.v4.js"></script>
<script src="../static/js/requests.js"></script>
<script src="../static/js/optimizer.js"></script>
<script type=text/javascript>
  $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
</script>

<div class="profile", style="margin-bottom: 10em">

		<div class="row">
			<div class="col-sm-4">
				<div class="panel panel-primary">
					{% if profiles %}
					<div class="panel-heading">
						<h3 class="panel-title">Profile to work with</b>:<br></h3>
					</div>
					<div class="panel-body">
                        <div class="col-sm-12">
                        <select id="profile-selection">
                            {% for profile in profiles %}


                               <option value={{ profile }}>{{ profile }}</option>


                            {% endfor %}
                        </select>
                        <br>
                        <h3><b>Profile Overview: </b></h3>
                            <h6 id="ts_used"><b>Training Set Used: </b> <div id="this_ts"></div></h6>
                            <h6 id="num_cmps"><b>Num Compounds: </b> <div id="cmps"></div></h6>
                            <h6 id="num_aids"><b>Num Assays: </b> <div id="aids"></div></h6>
                            <h6 id="total_acts"><b>Total Active Responses: </b><div id="tot_acts"></div></h6>
                            <h6 id="total_inacts"><b>Total Inactive Responses: </b><div id="tot_inacts"></div></h6>
                        </div>

                        <button onclick="deleteProfile()" class="btn btn-primary" style="background-color:red;border-color:white"
                                value="Delete Profile" name="deleteProfile">Delete Profile</button>
					</div>
					{% endif %}
					{% if not profiles %}
					<div class="panel panel-heading">
						<h3 class="panel-title">No datasets available for <b>{{ username }}.</b></h3>
					</div>
					<div class="panel-body">
						Please upload a data set to profile.
					</div>
					{% endif %}
				</div>
			</div>
		</div>

        <div class="row" style="margin-bottom: 5em">
            <div class="col-12">
            <div id="heatmap"></div>

            </div>
        </div>

    <div class="filter">
        <div class="row">
            <div class="col-sm-4">
                <div class="panel panel-primary">

                    <div class="panel-heading">
                            <h3 class="panel-title">Filters to apply</b>:<br></h3>
                    </div>



                    <div class="filters" class="panel-body">

                        <div class="row">

                            <div class="col-md-12">

                                <h3><b>Applied Filters: </b></h3>
                                <div id="applied-filters">
                                <!-- here is where the filters will be stored -->


                                </div>
                            </div>

                        </div>

                    <div class="row" class="apply-filters" style="margin: 2em">

                        <div class="col-sm-12">
                        <select id="stats-filter" style="margin-right: 2em">
                            <option value="CCR">CCR</option>
                            <option value="Sensitivity">Sensitivity</option>
                            <option value="Specificity">Specificity</option>
                        </select>

                        <select id="stats-threshold" style="margin-right: 2em">
                            <option value="0.1">0.1</option>
                            <option value="0.2">0.2</option>
                            <option value="0.3">0.3</option>
                            <option value="0.4">0.4</option>
                            <option value="0.5">0.5</option>
                            <option value="0.6">0.6</option>
                            <option value="0.7">0.7</option>
                            <option value="0.8">0.8</option>
                            <option value="0.9">0.9</option>
                        </select>

                            <button onclick="addFilter()" class="btn btn-primary"
                                value="Add Filter" name="addFilter">Add Filter</button>


                            <button onclick="sendFilters()" class="btn btn-primary"
                                value="Apply Filters" name="aggFilters">Apply Filters</button>

                            <button onclick="clearFilters()" class="btn btn-primary"
                                value="Clear Filters" name="clearFilters">Clear Filters</button>

                         </div>



                    </div>
                </div>
            </div>
        </div>

    </div>



</div>





    <script>





        refreshProfile();
        var data = aggFilters();


        var e = document.getElementById("profile-selection");
        e.addEventListener("change", function() {
            refreshProfile();
            clearFilters();
        });


        function sendFilters() {
        var filter_data = aggFilters();

        // get current profile
        var currentProfile = e.options[e.selectedIndex].value;

        data = {
            profile_name: currentProfile,

            filters: filter_data
        };

        postData('/filter_profile', data);
        refreshProfile();
        clearFilters();
    }



    </script>

{% endblock %}







